================================================================================
                    PERFIL DE ESPECIALISTA EM TESTES E2E
              Requisitos para Sistema de GestÃ£o de Restaurante
                         Data: 12 de Fevereiro de 2026
================================================================================

1. CONTEXTO DO PROJETO
================================================================================

Sistema: GestÃ£o de Restaurante (Spring Boot 3.2.2 + PostgreSQL)
Complexidade: Alta (concorrÃªncia, transaÃ§Ãµes financeiras, mÃ¡quina de estados)
Status Atual: 49 testes passando, 5 desabilitados por limitaÃ§Ãµes tÃ©cnicas
Problema CrÃ­tico: Testes de concorrÃªncia nÃ£o funcionam com MockMvc


2. PROBLEMAS TÃ‰CNICOS ATUAIS
================================================================================

2.1 ConcorrÃªncia e Race Conditions (CRÃTICO)
---------------------------------------------
âŒ Problema:
   - Testes com ExecutorService + MockMvc nÃ£o validam concorrÃªncia real
   - Threads nÃ£o compartilham contexto de persistÃªncia Spring
   - @Transactional nÃ£o propaga entre threads
   - OptimisticLockException nÃ£o Ã© testado adequadamente
   - SubPedidos criados em @BeforeEach nÃ£o visÃ­veis nas threads

âœ… ProteÃ§Ã£o Implementada (nÃ£o testada):
   - @Version em SubPedido e FundoConsumo
   - Isolation.SERIALIZABLE em transaÃ§Ãµes financeiras
   - IdempotÃªncia em operaÃ§Ãµes crÃ­ticas
   - ValidaÃ§Ã£o de transiÃ§Ãµes de estado

ğŸ“‹ Necessidade:
   Especialista que consiga criar testes E2E reais que validem:
   - 2 atendentes tentam entregar mesmo SubPedido â†’ 1 sucesso, 1 conflito 409
   - 2 cozinheiros tentam assumir mesmo SubPedido â†’ apenas 1 consegue
   - 10 threads criando pedidos simultaneamente â†’ sem duplicaÃ§Ã£o de dados
   - 2 processos debitam R$ 60 de fundo com R$ 100 â†’ 1 sucesso, 1 SaldoInsuficiente

2.2 Infraestrutura de Testes E2E
---------------------------------
âŒ Problema:
   - MockMvc nÃ£o cria novas transaÃ§Ãµes para cada thread
   - Contexto de persistÃªncia compartilhado causa falsos positivos
   - Testes unitÃ¡rios nÃ£o provam que sistema funciona em produÃ§Ã£o

âœ… SoluÃ§Ã£o Conhecida (nÃ£o implementada):
   - TestRestTemplate com SpringBootTest.WebEnvironment.RANDOM_PORT
   - Servidor HTTP embedded real (cada request = nova transaÃ§Ã£o)
   - Testcontainers com PostgreSQL real (opcional)
   - MÃºltiplos processos JVM (nÃ£o threads no mesmo processo)

ğŸ“‹ Necessidade:
   Especialista que domine:
   - ConfiguraÃ§Ã£o de TestRestTemplate com porta aleatÃ³ria
   - GestÃ£o de ciclo de vida de servidor embedded entre testes
   - Setup/teardown de dados via HTTP (nÃ£o @BeforeEach direto no DB)
   - SincronizaÃ§Ã£o de threads com CountDownLatch, CyclicBarrier
   - ValidaÃ§Ã£o de status HTTP (200, 201, 404, 409, 500)

2.3 Testes de Carga e Performance
----------------------------------
âŒ Problema:
   - Zero testes de performance implementados
   - NÃ£o sabemos se sistema aguenta 100 req/s
   - Deadline de produÃ§Ã£o ("sexta-feira na discoteca") se aproxima
   - Precisa validar antes de deploy

ğŸ“‹ Necessidade:
   Especialista que consiga:
   - Implementar teste de carga: 100 req/s por 60 segundos (6000 requests)
   - Stress test: 500 req/s por 30 segundos (15000 requests)
   - Validar taxa de sucesso >97% (tolerÃ¢ncia <3% erro)
   - Configurar JMeter ou Gatling para testes distribuÃ­dos
   - Analisar mÃ©tricas: p95 latency, throughput, error rate
   - Validar integridade de dados apÃ³s carga (SQL queries de validaÃ§Ã£o)

2.4 Security e Authorization
-----------------------------
âŒ Problema:
   - Security desabilitada em testes via @AutoConfigureMockMvc(addFilters=false)
   - NÃ£o testamos se @PreAuthorize funciona corretamente
   - Roles (CLIENTE, ATENDENTE, COZINHA, GERENTE) nÃ£o validadas em E2E
   - OTP authentication nÃ£o testada

ğŸ“‹ Necessidade:
   Especialista que implemente:
   - Testes E2E com security habilitada
   - Login via OTP + obtenÃ§Ã£o de token JWT
   - ValidaÃ§Ã£o de permissÃµes por role em cada endpoint
   - Testes de autorizaÃ§Ã£o: ATENDENTE nÃ£o pode assumir (403 FORBIDDEN)
   - Testes de autenticaÃ§Ã£o: sem token â†’ 401 UNAUTHORIZED
   - CORS validation em cenÃ¡rios cross-origin

2.5 Isolamento e GestÃ£o de Estado
----------------------------------
âŒ Problema:
   - Testes interferem entre si quando usam mesmo banco H2
   - @DirtiesContext muito lento (reinicia contexto Spring)
   - Faltam estratÃ©gias de cleanup eficientes
   - IDs hardcoded quebram em ambientes com dados prÃ©-existentes

ğŸ“‹ Necessidade:
   Especialista que domine:
   - EstratÃ©gias de isolamento: @Sql, @Transactional rollback, Testcontainers
   - Cleanup via HTTP DELETE ou SQL truncate
   - Uso de dados aleatÃ³rios (random IDs, random nomes)
   - ValidaÃ§Ã£o de estado via GET antes de cada teste
   - ParalelizaÃ§Ã£o de testes sem conflitos


3. PERFIL TÃ‰CNICO REQUERIDO
================================================================================

3.1 Conhecimentos ObrigatÃ³rios
-------------------------------
âœ… Spring Boot Testing (ESSENCIAL):
   - @SpringBootTest com WebEnvironment.RANDOM_PORT
   - TestRestTemplate: headers, body, params, status codes
   - @Sql para setup/cleanup de dados
   - @TestConfiguration para beans de teste
   - Profiles de teste (@ActiveProfiles("test"))

âœ… Testes de ConcorrÃªncia (ESSENCIAL):
   - ExecutorService, CountDownLatch, CyclicBarrier
   - CompletableFuture, AtomicInteger, CopyOnWriteArrayList
   - Race conditions: detecÃ§Ã£o e validaÃ§Ã£o
   - OptimisticLockException: como provocar e validar via HTTP 409
   - Isolation levels: SERIALIZABLE, REPEATABLE_READ

âœ… JUnit 5 + AssertJ (ESSENCIAL):
   - Assertions complexas: extracting(), filteredOn(), anySatisfy()
   - Testes parametrizados: @ParameterizedTest, @MethodSource
   - Lifecycle: @BeforeAll, @BeforeEach, @AfterEach
   - Conditions: @EnabledIf, @DisabledOnOs
   - Parallel execution: @Execution(CONCURRENT)

âœ… HTTP e REST APIs (ESSENCIAL):
   - Status codes semÃ¢nticos: 200, 201, 204, 400, 401, 403, 404, 409, 500
   - Headers: Authorization (Bearer token), Content-Type, Accept
   - JSON: serializaÃ§Ã£o, deserializaÃ§Ã£o, JsonPath
   - PATCH vs PUT: diferenÃ§as semÃ¢nticas
   - IdempotÃªncia: GET, PUT, DELETE sÃ£o idempotentes

3.2 Conhecimentos DesejÃ¡veis
-----------------------------
â­ Testcontainers (MUITO DESEJÃVEL):
   - PostgreSQL container para testes E2E reais
   - Lifecycle: startup, stop, cleanup
   - Network: comunicaÃ§Ã£o entre containers
   - Volumes: persistÃªncia de dados entre testes
   - Performance: reuso de containers com @Container(reuse=true)

â­ JMeter / Gatling (MUITO DESEJÃVEL):
   - Scripts de teste de carga
   - Ramp-up, throughput shaping, duraÃ§Ã£o
   - Assertions: response time, error rate, status code
   - RelatÃ³rios: HTML dashboard, grÃ¡ficos, mÃ©tricas
   - Distributed testing: master-slave setup

â­ Spring Security Testing (DESEJÃVEL):
   - @WithMockUser, @WithUserDetails
   - SecurityMockMvcRequestPostProcessors
   - JWT: geraÃ§Ã£o, validaÃ§Ã£o, refresh token
   - @PreAuthorize, @Secured: validaÃ§Ã£o em testes

â­ WireMock (DESEJÃVEL):
   - Mock de APIs externas
   - Stubbing: request matching, response templating
   - VerificaÃ§Ã£o: quantas vezes endpoint foi chamado

3.3 ExperiÃªncias Relevantes
----------------------------
âœ… Testou sistemas com race conditions reais
âœ… Implementou testes E2E com servidor HTTP real (nÃ£o MockMvc)
âœ… Configurou testes de carga para validar capacidade (req/s)
âœ… Trabalhou com transaÃ§Ãµes e locks otimistas (@Version)
âœ… Debugou problemas de concorrÃªncia em produÃ§Ã£o
âœ… Implementou CI/CD com quality gates baseados em testes


4. HABILIDADES COMPORTAMENTAIS
================================================================================

âœ… Pensamento CrÃ­tico:
   - Questiona se teste realmente valida o que pretende
   - Identifica falsos positivos: "teste passa mas cÃ³digo estÃ¡ errado"
   - Identifica falsos negativos: "teste falha mas cÃ³digo estÃ¡ correto"

âœ… AtenÃ§Ã£o a Detalhes:
   - Percebe diferenÃ§as sutis: MockMvc vs TestRestTemplate
   - Identifica race conditions: "funciona 99% do tempo, falha 1%"
   - Valida edge cases: saldo exatamente zero, Ãºltimo item em estoque

âœ… DocumentaÃ§Ã£o:
   - Explica POR QUE teste estÃ¡ desabilitado (nÃ£o apenas @Disabled)
   - Documenta limitaÃ§Ãµes tÃ©cnicas: "threads nÃ£o herdam @Transactional"
   - Cria guias de execuÃ§Ã£o: README de testes, troubleshooting

âœ… Pragmatismo:
   - Sabe quando teste E2E real Ã© necessÃ¡rio vs teste unitÃ¡rio suficiente
   - Balanceia cobertura vs tempo de execuÃ§Ã£o
   - Prioriza testes de cenÃ¡rios crÃ­ticos (pagamentos, concorrÃªncia)


5. TAREFAS PRIORITÃRIAS
================================================================================

5.1 SPRINT 1 (Semana 1) - CRÃTICO
-----------------------------------
ğŸ¯ Objetivo: Validar concorrÃªncia antes de produÃ§Ã£o

Tarefa 1.1: Reabilitar ConcurrencyRealE2ETest (3 testes)
   - Migrar de MockMvc para TestRestTemplate + RANDOM_PORT
   - Implementar: doisAtendentesEntregandoMesmoSubPedido()
   - Implementar: doisCozinheirosAssumindoMesmoSubPedido()
   - Implementar: dezThreadsCriandoPedidosSimultaneamente()
   - Validar: OptimisticLockException retorna HTTP 409 CONFLICT
   - CritÃ©rio de sucesso: 1 thread sucesso, 1 thread conflito (nÃ£o 2 sucessos)

Tarefa 1.2: Criar LoadTest funcional (2 testes)
   - Teste de carga: 100 req/s * 60s = 6000 requests
   - Stress test: 500 req/s * 30s = 15000 requests
   - Validar: >97% taxa de sucesso
   - Validar: zero saldos negativos apÃ³s teste
   - Validar: zero pedidos duplicados apÃ³s teste

Tarefa 1.3: Criar SubPedidoControllerTest (8 testes)
   - Endpoints: PATCH /subpedidos/{id}/entregar, assumir, pronto, cancelar
   - Validar: status codes corretos (200, 404, 400, 409)
   - Validar: JSON response structure
   - Validar: OptimisticLockException â†’ 409 CONFLICT

5.2 SPRINT 2 (Semana 2) - ALTA PRIORIDADE
-------------------------------------------
ğŸ¯ Objetivo: Testes de security e controllers restantes

Tarefa 2.1: SecurityPermissionsTest (5 testes)
   - Testar: ATENDENTE nÃ£o pode assumir (403 FORBIDDEN)
   - Testar: COZINHA nÃ£o pode marcar entregue (403)
   - Testar: CLIENTE nÃ£o pode alterar estado (403)
   - Testar: GERENTE pode cancelar de qualquer estado (200)
   - Testar: sem token â†’ 401 UNAUTHORIZED

Tarefa 2.2: Controller Tests para APIs restantes
   - MesaController: 6 testes
   - PedidoController: 8 testes
   - PagamentoController: 6 testes
   - AuthController: 4 testes
   - Validar: serializaÃ§Ã£o, deserializaÃ§Ã£o, validations

5.3 SPRINT 3 (Semana 3) - MÃ‰DIA PRIORIDADE
--------------------------------------------
ğŸ¯ Objetivo: Infraestrutura avanÃ§ada e otimizaÃ§Ã£o

Tarefa 3.1: Testcontainers Setup (opcional)
   - PostgreSQL container para testes E2E
   - Validar: comportamento idÃªntico ao H2
   - BenefÃ­cio: detecÃ§Ã£o de incompatibilidades SQL

Tarefa 3.2: JMeter Scripts
   - Script: criar 1000 pedidos simultÃ¢neos
   - Script: simular 50 usuÃ¡rios por 5 minutos
   - RelatÃ³rios: HTML dashboard com mÃ©tricas

Tarefa 3.3: CI/CD Integration
   - GitHub Actions: rodar testes em pull requests
   - Quality gate: mÃ­nimo 80% cobertura
   - Falha de build se testes E2E falharem


6. ENTREGÃVEIS ESPERADOS
================================================================================

6.1 CÃ³digo
----------
âœ… 3 testes E2E de concorrÃªncia funcionando (ConcurrencyRealE2ETest)
âœ… 2 testes de carga funcionando (LoadTest)
âœ… 8 testes de controller (SubPedidoControllerTest)
âœ… 5 testes de security (SecurityPermissionsTest)
âœ… Scripts JMeter configurados e documentados

6.2 DocumentaÃ§Ã£o
----------------
âœ… TESTES_EXECUCAO.md atualizado:
   - Como rodar testes E2E com TestRestTemplate
   - Como interpretar falhas de concorrÃªncia (409 Ã© sucesso!)
   - Como rodar testes de carga
   - Como analisar resultados JMeter

âœ… RELATORIO_TESTES.txt atualizado:
   - Adicionar seÃ§Ã£o "Testes E2E Reais"
   - Documentar cobertura de concorrÃªncia
   - Listar todos os cenÃ¡rios validados

âœ… Troubleshooting Guide:
   - O que fazer quando teste de concorrÃªncia falha?
   - Como debugar OptimisticLockException?
   - Como aumentar carga nos testes?

6.3 ValidaÃ§Ã£o de Qualidade
---------------------------
âœ… Todos testes E2E passando consistentemente (nÃ£o flaky)
âœ… Testes de carga validam capacidade mÃ­nima (100 req/s)
âœ… Cobertura de controller aumenta de 40% â†’ 80%
âœ… Zero testes @Disabled sem justificativa tÃ©cnica
âœ… Tempo de execuÃ§Ã£o <5 minutos para suite completa


7. CRITÃ‰RIOS DE SUCESSO
================================================================================

7.1 TÃ©cnicos
------------
âœ… OptimisticLockException testado e validado via HTTP 409
âœ… 100 req/s sustentados por 60 segundos sem falhas
âœ… Taxa de sucesso >97% em testes de carga
âœ… Todos endpoints retornam status codes corretos
âœ… Security validada: roles, permissions, authentication

7.2 NegÃ³cio
-----------
âœ… Sistema pode ir para produÃ§Ã£o com confianÃ§a
âœ… ConcorrÃªncia provada: 2 usuÃ¡rios no mesmo recurso â†’ 1 ganha
âœ… Performance validada: aguenta carga esperada
âœ… Risco de bugs em produÃ§Ã£o reduzido drasticamente

7.3 Processo
------------
âœ… Testes executam em <5 minutos (feedback rÃ¡pido)
âœ… Desenvolvedores conseguem rodar localmente
âœ… CI/CD pipeline configurado e funcionando
âœ… DocumentaÃ§Ã£o completa e atualizada


8. DIFERENCIAL (Nice to Have)
================================================================================

â­ ExperiÃªncia com Gatling (melhor que JMeter para cÃ³digo Scala)
â­ Conhecimento de Chaos Engineering (Chaos Monkey)
â­ ExperiÃªncia com Contract Testing (Pact)
â­ Conhecimento de Mutation Testing (PIT)
â­ Familiaridade com ArchUnit (validar arquitetura via testes)
â­ ExperiÃªncia com Performance Profiling (VisualVM, YourKit)


9. FORMATO DE TRABALHO
================================================================================

Modalidade: Presencial ou Remoto
DuraÃ§Ã£o: 3 semanas (SPRINT 1 Ã© crÃ­tico - 1 semana)
Regime: Full-time (40h/semana) ou Part-time (20h/semana)

InteraÃ§Ã£o Esperada:
  - Daily: status de testes implementados vs planejados
  - Code review: pair programming em testes complexos
  - DocumentaÃ§Ã£o: incremental (nÃ£o apenas no final)
  - Handover: transferÃªncia de conhecimento para equipe


10. PERGUNTAS PARA O CANDIDATO
================================================================================

10.1 TÃ©cnicas
-------------
1. "Explique a diferenÃ§a entre MockMvc e TestRestTemplate. Quando usar cada um?"
2. "Como vocÃª testaria OptimisticLockException em um cenÃ¡rio E2E real?"
3. "2 threads tentam debitar R$ 60 de uma conta com R$ 100. Como garantir que 
    apenas 1 sucesso ocorra? Como testar isso?"
4. "Como vocÃª implementaria um teste de carga de 100 req/s por 60 segundos?"
5. "O que significa HTTP 409 CONFLICT? Quando Ã© um resultado esperado?"

10.2 ExperiÃªncia
----------------
1. "Conte sobre um bug de concorrÃªncia que vocÃª encontrou via testes E2E."
2. "Qual foi o teste mais complexo que vocÃª jÃ¡ implementou? Por quÃª?"
3. "Como vocÃª organizaria uma suite de 200 testes E2E para executar em <10 min?"
4. "JÃ¡ trabalhou com Testcontainers? Quais foram os desafios?"
5. "JÃ¡ configurou JMeter ou Gatling? Qual prefere e por quÃª?"

10.3 Comportamentais
--------------------
1. "Como vocÃª convenceria um time a investir tempo em testes E2E?"
2. "O que vocÃª faz quando um teste Ã© flaky (passa Ã s vezes, falha outras)?"
3. "Como vocÃª prioriza quais testes E2E implementar primeiro?"
4. "Como vocÃª documenta testes complexos para facilitar manutenÃ§Ã£o?"


11. RECURSOS E APOIO DISPONÃVEL
================================================================================

âœ… Sistema Funcionando: Todos endpoints operacionais via api-tests.http
âœ… Testes Service: 46 testes passando (service layer sÃ³lido)
âœ… DocumentaÃ§Ã£o: ARQUITETURA.md, API_EXAMPLES.md, DEPLOYMENT.md
âœ… Infraestrutura BÃ¡sica: TestSecurityConfig, ConcurrencyE2ETest estrutura pronta
âœ… Team Support: Time de desenvolvimento disponÃ­vel para dÃºvidas de negÃ³cio


12. EXPECTATIVA DE IMPACTO
================================================================================

Antes (Status Atual):
  âŒ Testes de concorrÃªncia desabilitados (@Disabled)
  âŒ Zero testes de carga
  âŒ ProteÃ§Ã£o contra race conditions nÃ£o validada
  âŒ Risco de bugs em produÃ§Ã£o: ALTO
  âŒ ConfianÃ§a para deploy: BAIXA

Depois (ApÃ³s ContrataÃ§Ã£o):
  âœ… Testes de concorrÃªncia funcionando e validados
  âœ… Sistema testado sob carga real (100 req/s)
  âœ… OptimisticLockException provado via E2E
  âœ… Risco de bugs em produÃ§Ã£o: BAIXO
  âœ… ConfianÃ§a para deploy: ALTA
  âœ… Sistema pronto para "sexta-feira na discoteca" ğŸ‰


================================================================================
                              CONTATO E PRÃ“XIMOS PASSOS
================================================================================

Se vocÃª se identifica com este perfil e tem experiÃªncia resolvendo os problemas
descritos, gostarÃ­amos de conversar!

PrÃ³ximos Passos:
  1. Review deste documento (PERFIL_ESPECIALISTA_TESTES_E2E.txt)
  2. Review do RELATORIO_TESTES.txt (status atual)
  3. Review do TESTES_EXECUCAO.md (tentativa anterior)
  4. Entrevista tÃ©cnica: discussÃ£o de abordagem para SPRINT 1
  5. Teste prÃ¡tico (opcional): implementar 1 teste E2E de concorrÃªncia

Esperamos encontrar alguÃ©m que ame o desafio de testar sistemas complexos e
que entenda que um teste E2E bem feito vale mais que 100 testes unitÃ¡rios
que nÃ£o provam concorrÃªncia real! ğŸ’ª

================================================================================
                                 FIM DO PERFIL
================================================================================
